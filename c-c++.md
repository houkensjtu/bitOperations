# C/C++

### 背景和历史

C语言是为了帮助Unix开发而发明的语言。C语言相比它的前身B语言，有了型的概念。C语言中有字符，整数，浮点数这几种基础数据类型，并有指针，数组，结构体等衍生数据类型。C语言提供了基本的条件判断\(if-else\)和循环体\(while, for\)语句。C的函数可以返回任何基础数据类型，或者指针，或者结构体**\(不能直接返回数组\)。**

从语言特征上看，C语言很接近底层硬件，因为C可以直接操作内存。C语言也很精简，没有包括很多库，也没有提供并行运算等高级功能。这些都是为了保持语言本身小而美做出的牺牲。

C语言是跨平台的，可以在多种电脑架构上运行。C语言并不是非常强的型语言\(not a strongly-typed language\)，但是在C标准的发展过程中，对于型转换的规定越来越严格，比如早期指针和整数的转换是自由的，但是现在需要明确的声明才可以进行。

### 基本程序结构

每个C程序都需要有一个main函数，printf这个函数来自于stdio.h头文件，所以需要在程序开始的时候导入。一个小细节，K&R书中的风格是把函数体的花括号自成一行编写的~~，这样比较有逼格~~。另外，缩进并没有严格的规定，这里采用2格使得文面更加整洁紧凑。

```c
#include <stdio.h>

int main()
{
  printf("Hello world!\n");
}
```

#### 循环体

第二个程序是打印一个摄氏温度与华氏温度的转换表，需要用到基本的变量声明语句，基本的循环体和格式打印语句。

```c
#include <stdio.h>

int main()
{
  float celsius, fahr;
  int upper, lower, step;
  lower = 0;
  upper = 300;
  step  = 10;
  
  fahr = lower;
  
  // while循环体版本
  while(fahr <= upper) {
    celsius = (5.0/9.0)*(fahr-32.0);
    printf("%3.0f\t%6.1f\n",fahr,celsius)
    fahr += step;
  }
  
  // for 循环体版本
  for(fahr=lower; fahr<=uppper; fahr+=step) {
    celsius = (5.0/9.0)*(fahr-32.0);
    printf("%3.0f\t%6.1f\n",fahr,celsius)
  }
}
```

这里我们再次观察到几个细节：

* 同类型变量声明可以放在同一行，用逗号隔开
* fahr = lower这个语句事实上发生了浮点数与整数的自动转换，C语言会负责自动将lower转成浮点数然后代入fahr
* printf中的%是一个占位符，用来吸收逗号后面的变量；%f是浮点数，%d是整数
* while循环体后面的花括号是不换行的，这和主函数的声明不一样

另外，注意到0,300,20这些数字，其实并不需要是变量，但是在程序中用一些意味不明的魔法数字又是不好的习惯，所以我们可以用符号常量的方法：

```c
#include <stdio.h>

// 符号常量习惯上用大写表示，以便与变量区分
// 另外，define语句的末尾没有分号
#define UPPER 300
#define LOWER 0
#define STEP 20

int main()
{  
  float celsius, fahr;
  fahr = LOWER;
  ...
}
```

#### 简单的输入输出程序

K&R的书中在这里开始介绍了一些比较难解的文件IO程序例子，这里仅仅列举第一个作介绍：

```c
#include <stdio.h>

int main()
{
  int c;
  while((c=getchar()) != EOF)
    putchar(c);
}
```

getchar\(\)这个函数的作用，是从标准输入中读取一个字符，每次读取结束由键盘的回车来决定，如果回车之前输入了多个字符，那getchar\(\)仅仅返回第一个字符。这个程序难解的原因之一是，**实际运行时每输入一个字符并不会直接打印出来，而是会进入line buffer**，等到回车以后再打印出。这个buffer的动作在这段代码里是看不出来的\(这是操作系统terminal提供的功能\)，K&R书中也没有做介绍，所以让读者容易陷入困惑。

另外值得注意的一个技巧是，**在C中所有的赋值表达式本身，也都是有值的**，比如c=getchar\(\)这个语句的值，就是赋值后c的值。因此，可以用语句来作为while条件判断的一部分。

最后，如果你感到疑惑，getchar\(\)和scanf\(\)都是从stdin中读取数据，不同的是scanf是带有格式指定的，而getchar\(\)没有。

#### 数组

我们要浅尝一下数组的使用，数组的基本使用无非有几个点：数组的声明，数组的初始化，数组的取用。

```c
int i;
int ndigit[10];

// 逐一赋值
for (i=0; i<10; i++){
  ndigit[i] = 0;
}
// 作为数组赋值
ndigit[] = {0,1,2,3,4,5,6,7,8,9};
ndigit[10] = {0,1,2,3,4,5,6,7,8,9};
```

数组声明的方法就是在变量名后面加上方括号和数组的大小，数组的index在C中是从0开始的。数组赋值的方法，除了逐一赋值，也可以用给定数组的方法赋值，**注意到数组常量的表示法是用花括号而不是方括号**！

#### 简单函数声明

函数和变量一样，在使用前不仅要定义还需要声明。

```c
#include <stdio.h>

// 函数需要事先声明
int power(int m, int n);
// 声明的时候可以只给出参数的类型，不需要赋予名字
int power(int, int)

main()
{
  int i = 0;
  for (i=0; i<10; i++)
    printf("%6d \n",power(i));
}

int power(int base, int n)
{
  int i,p;
  
  p = 1;
  for (i=n; i>0; i--)
    p = p*base;
  return p;
}

```

### 变量声明

